var add_before=document.getElementById("add_before"),add_after=document.getElementById("add_after"),del=document.getElementById("delete"),continuous=document.getElementById("continuous"),uniform=document.getElementById("uniform"),save=document.getElementById("save"),open=document.getElementById("open"),reset=document.getElementById("reset"),load_image=document.getElementById("load_image");function set_l_to_current_point(e){l_value_slider.value=e,l_value=e,load_l_value_image(e)}reset.onclick=function(){var e=new Image;e.src="img/50.0.png",e.onload=function(){c.drawImage(e,0,0,canvas.width,canvas.height),point_list=[],select_point_list.innerHTML="",graph_context.clearRect(0,0,graph_canvas.width,graph_canvas.height),color_band_context.clearRect(0,0,color_band_canvas.width,color_band_canvas.height)}},save.onclick=function(){var e=get_content(),t=document.getElementById("filename").value,n=new Blob([e],{type:"text/plain;charset=utf-8"}),l=document.getElementById("type").value;saveAs(n,t+"."+l)},uniform.onclick=function(){if(select_point_list.selectedOptions.length>2){for(var e=point_list[select_point_list.selectedOptions[0].index].lab[0],t=(point_list[select_point_list.selectedOptions[select_point_list.selectedOptions.length-1].index].lab[0]-e)/(select_point_list.selectedOptions.length-1),n=0;n<select_point_list.selectedOptions.length;n++){var l=Math.round(e+t*n);if(valid_l_value(select_point_list.selectedOptions[n].index,l))point_list[select_point_list.selectedOptions[n].index].lab[0]=l,point_list[select_point_list.selectedOptions[n].index].rgb=labTOrgb(point_list[select_point_list.selectedOptions[n].index].lab);else{var i=JSON.parse(JSON.stringify(point_list[select_point_list.selectedOptions[n].index])),o=0,_=0;o=i.xy[0]>canvas.width/2?-(i.xy[0]-canvas.width/2)/200:(canvas.width/2-i.xy[0])/200,_=i.xy[1]>canvas.height/2?-(i.xy[1]-canvas.height/2)/200:(canvas.height/2-i.xy[1])/200;for(var s=i.xy[0],a=i.xy[1];;){s+=o,a+=_;var d=[l,getA(Math.floor(s)),getB(Math.floor(a))],c=labTOrgb(d);if(isValidRGB(c)){i.xy[0]=Math.floor(s),i.xy[1]=Math.floor(a),i.lab=d,i.rgb=c,point_list[select_point_list.selectedOptions[n].index]=i;break}}}select_point_list.selectedOptions[n].innerHTML="&nbspL:"+point_list[select_point_list.selectedOptions[n].index].lab[0].toFixed(1)+",&nbsp&nbsp R:"+point_list[select_point_list.selectedOptions[n].index].rgb[0].toFixed(3)+",&nbsp&nbsp G:"+point_list[select_point_list.selectedOptions[n].index].rgb[1].toFixed(3)+",&nbsp&nbsp B:"+point_list[select_point_list.selectedOptions[n].index].rgb[2].toFixed(3)+"&nbsp&nbsp"}draw_points(),draw_color_pattern(),draw_graph()}else alert("Select at least three points")},continuous.onclick=function(){point_list.length>1?draw_smooth?(continuous.value="Continuous",draw_smooth=!1,draw_color_pattern()):(continuous.value="Discrete",draw_smooth=!0,draw_color_pattern()):alert("Select at least two points")},del.onclick=function(){selected_point_index>-1?(point_list.splice(selected_point_index,1),select_point_list[selected_point_index].remove(),selected_point_index=-1,select_point_list.selectedIndex=-1,draw_points(),draw_graph(),draw_color_pattern()):alert("Please select a point first")},add_before.onclick=function(){selected_point_index>-1?add_before_active?(add_before_active=!1,add_before.style.backgroundColor=""):add_after_active?(add_before_active=!0,add_before.style.backgroundColor="yellow",add_after_active=!1,add_after.style.backgroundColor=""):(add_before_active=!0,add_before.style.backgroundColor="yellow"):alert("Please select a point first")},add_after.onclick=function(){selected_point_index>-1?add_before_active?(add_after_active=!0,add_after.style.backgroundColor="yellow",add_before_active=!1,add_before.style.backgroundColor=""):add_after_active?(add_after_active=!1,add_after.style.backgroundColor=""):(add_after_active=!0,add_after.style.backgroundColor="yellow"):alert("Please select a point first")},select_point_list.oninput=function(){point_list[select_point_list.selectedIndex].lab[0]==l_value?(remove_previous_selected(),selected_point_index=select_point_list.selectedIndex,draw_selected_point()):(set_l_to_current_point(point_list[select_point_list.selectedIndex].lab[0]),selected_point_index=select_point_list.selectedIndex,draw_points()),draw_color_pattern()},weight_slider.oninput=function(){var e=parseInt(weight_slider.value)/100;weight_label.innerHTML="W:&nbsp"+e,CIElab_A_WEIGHT=e,CIElab_B_WEIGHT=e,draw_graph()},l_value_slider.oninput=function(){if(selected_point_index>-1){l_value=parseInt(l_value_slider.value);var e=JSON.parse(JSON.stringify(point_list[selected_point_index]));point_list[selected_point_index].lab[0]=l_value,point_list[selected_point_index].rgb=labTOrgb(point_list[selected_point_index].lab),isValidRGB(point_list[selected_point_index].rgb)?(load_l_value_image(l_value),select_point_list[selected_point_index].innerHTML="&nbspL:"+point_list[selected_point_index].lab[0].toFixed(1)+",&nbsp&nbsp R:"+point_list[selected_point_index].rgb[0].toFixed(3)+",&nbsp&nbsp G:"+point_list[selected_point_index].rgb[1].toFixed(3)+",&nbsp&nbsp B:"+point_list[selected_point_index].rgb[2].toFixed(3)+"&nbsp&nbsp",draw_graph()):(point_list[selected_point_index]=e,l_value=e.lab[0],l_value_slider.value=l_value)}else l_value=parseInt(l_value_slider.value),load_l_value_image(l_value)},load_l_value_image=function(e){var t=new Image;t.src="img/"+e+".0.png",t.onload=function(){c_bg.drawImage(t,0,0,canvas.width,canvas.height)},l_value_label.innerHTML="L:&nbsp;"+l_value_slider.value};
